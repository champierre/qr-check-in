{"files":[{"id":"8ba157cf-552b-4a3e-a342-c85103957c27","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"63542499-fd49-4472-aa86-d094787673c5","name":"コード","type":"server_js","source":"const activeSheet \u003d SpreadsheetApp.getActiveSpreadsheet();\n\nfunction checkIn(memberData) {\n  const dataSheet \u003d activeSheet.getSheetByName(\u0027CheckIn\u0027);\n  const timestamp \u003d toDateTimeEntry(Date.now());\n  dataSheet.appendRow([\n    timestamp,\n    memberData.memberId,\n    memberData.memberName,\n    memberData.memberSchool,\n    memberData.memberDetail,\n  ]);\n  return {id: memberData.memberId, timestamp: timestamp};\n}\n\nfunction toDateTimeEntry(epochTime) {\n  const date \u003d new Date(epochTime);\n  //get timezone of spreadsheet\n  var tz \u003d SpreadsheetApp.getActiveSpreadsheet().getSpreadsheetTimeZone();\n\n  //format date to readable format\n  var formatted \u003d Utilities.formatDate(date, tz, \u0027yyyy/MM/dd HH:mm:ss\u0027);\n\n  return formatted;\n}\n\nfunction doPost(e) {\n  // const reqParam \u003d e.parameter;\n  const reqParam \u003d JSON.parse(e.postData.getDataAsString());\n\n  const dataSheet \u003d activeSheet.getSheetByName(\u0027log\u0027);\n  dataSheet.appendRow([toDateTimeEntry(Date.now()), JSON.stringify(reqParam)]);\n  console.log(reqParam)\n\n  switch (reqParam.action) {\n    case \"checkIn\":\n      {\n        const result \u003d checkIn(reqParam);\n        return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);\n      }\n      break;\n    default:\n      {\n        const result \u003d \u0027did nothing\u0027;\n        return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);\n      }\n      break;\n  }\n}\n\n// debug on doPost\nfunction doPostTest() {\n  const postData \u003d {\n    action: \u0027checkIn\u0027,\n    memberId: \u00273d6v\u0027,\n    memberName: \u0027横川耕二\u0027,\n    memberSchool: \u0027大学\u0027,\n    memberDetail: \u0027青学つくまなラボ\u0027,\n  }\n  const e \u003d {\n    postData : Utilities.newBlob(JSON.stringify(postData))\n  };\n  doPost(e);\n}\n\nfunction checkInTest() {\n  checkIn(\u00271\u0027)\n}\n"}]}